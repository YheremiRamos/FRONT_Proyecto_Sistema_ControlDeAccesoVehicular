<div class="main-container">
    <app-menu></app-menu>
    <div class="content">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <mat-horizontal-stepper linear #stepper >
                        <!-- Apartado 1: Tipo de usuario, Tipo de vehículo y Espacios disponibles -->
                        <mat-step [stepControl]="formRegistraUsuario" label="Selección Inicial" >
                            <form [formGroup]="formRegistraUsuario">
                                <div class="row">
                                    <mat-toolbar
                                        style="background:#4B9DA6; border-radius: 20px 20px 20px 20px; padding-left: 5%;">
                                        <h1>Selección Inicial</h1>
                                    </mat-toolbar>
                                </div>
        
                                <div class="col-md-20" style="margin: 0 5%;">
                                <div class="seleccionInicial">
                                    <!-- Combo box Tipo de usuario -->
                                    <div class="inputContent">
                                        <h5>1. Tipo de usuario:</h5>
                                        <mat-form-field class="col-md-6" style="margin: auto;">
                                        <mat-label>Seleccione el tipo de usuario</mat-label>
                                        <mat-select formControlName="tipoUsuario">
                                            <mat-option value="-1">[Seleccione el tipo de usuario]</mat-option>
                                            <mat-option value="Propietario">Propietario</mat-option>
                                            <mat-option value="Visitante">Visitante</mat-option>
                                        </mat-select>
                                        </mat-form-field>
                                    </div>
                                
                                    <form [formGroup]="formRegistraVehiculo">
                                    <!-- Combo box Tipo de vehículo -->
                                        <div class="inputContent">
                                        <h5>2. Tipo de vehículo:</h5>
                                        <mat-form-field class="col-md-6" style="margin: auto;">
                                            <mat-label>Tipo vehículo</mat-label>
                                            <mat-select formControlName="tipoVehiculo" (selectionChange)="onTipoVehiculoChange($event.value)">
                                            <mat-option value="-1">[Seleccione el tipo de vehículo]</mat-option>
                                            <mat-option value="Automovil">Automovil</mat-option>
                                            <mat-option value="Motocicleta">Motocicleta</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        </div>
                                    </form>

        
                                    <div class="row">
            
                                        <!-- Espacios de estacionamiento gráfico -->
                                    
                                        <h4 style="text-align: center; margin: 1ch auto 1ch auto;">Espacios de parqueo disponibles</h4>
                                        <div class="row leyenda">
                                            <div class="col-md-4">
                                                <div class="leyenda-item generales">
                                                    <span class="color-general"></span>
                                                    <h6>Generales</h6>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="leyenda-item discapacitados">
                                                    <span class="color-discapacitado"></span>
                                                    <h6>Discapacitados</h6>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="leyenda-item gerencia">
                                                    <span class="color-gerencia"    ></span>
                                                    <h6>Gerencia</h6>
                                                </div>
                                            </div>
                                        </div>


                                        <!-- Espacios de estacionamiento -->
                        <div class="contenedor_espacios">
                            <div class="parking-layout">
                            <!-- Espacios para el Primer Nivel -->
                            <div *ngIf="mostrarNivelPrincipal" class="parking-section"  [@fadeSlide]>
                                <h5>Primer nivel (Principal)</h5>
                                <div class="parking-spaces">
                                <button class="d" *ngFor="let espacio of espaciosDiscapacitadoPP"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button class="gt" *ngFor="let espacio of espacioGerentePP"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button *ngFor="let espacio of espaciosGeneralPP"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                </div>
                            </div>
                    
                            <!-- Espacios para el Semi-Sótano -->
                            <div *ngIf="mostrarNivelSemiSotano" class="parking-section">
                                <h5>Semi-Sótano</h5>
                                <div class="parking-spaces">
                                <button class="gt" *ngFor="let espacio of espacioGerentePS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button *ngFor="let espacio of espaciosGeneralPS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button class="d" *ngFor="let espacio of espaciosDiscapacitadoPS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                </div>
                            </div>
                    
                            <!-- Espacios para el Sótano -->
                            <div *ngIf="mostrarNivelSotano" class="parking-section">
                                <h5>Sótano</h5>
                                <div class="parking-spaces">
                                <button class="gt" *ngFor="let espacio of espacioGerentePSS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button *ngFor="let espacio of espaciosGeneralPSS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                <button class="d" *ngFor="let espacio of espaciosDiscapacitadoPSS"
                                    (click)="seleccionarEspacio(espacio)" [ngClass]="{'selected': +espacio === espacioSeleccionado}">
                                    {{ espacio }}
                                </button>
                                </div>
                            </div>
                            </div>
                        </div>
                        </div>

                                    </div>

                                </div>
        
                                <div class="row btnEnd">
                                    <button mat-raised-button (click)="stepper.next()" color="primary">Siguiente
                                        <mat-icon>arrow_forward</mat-icon>
                                    </button>
                                </div>
                            </form>
                        </mat-step>
        
                        <!-- Apartado 2: Datos del cliente -->
                        <mat-step [stepControl]="formRegistraUsuario" label="Datos del Cliente" >
                            <form [formGroup]="formRegistraUsuario">
                                <div class="row">
                                    <mat-toolbar
                                        style="background:#4B9DA6; border-radius: 20px 20px 20px 20px; padding-left: 5%;">
                                        <h1>Datos del Cliente</h1>
                                    </mat-toolbar>
                                </div>
                
                                
                            <div  class="col-md-20" style="margin: 0 5%;">
                                <div class="inputContent">
                                    <h5>2. DNI/Documento:</h5>
                                    <mat-form-field class="col-md-6">
                                        <mat-label>Ingrese el número de documento</mat-label>
                                        <input matInput [(ngModel)]="varDni" formControlName="dni" maxlength="12">
                                        <mat-hint style="color: red" *ngIf="formRegistraUsuario.controls.dni.touched">
                                            <span *ngIf="formRegistraUsuario.controls.dni.hasError('required')">
                                                La identificación es requerida
                                                
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.dni.hasError('pattern')">
                                                Ingrese una identificación válida
                                            </span>
                                        </mat-hint>
                                    </mat-form-field>
                                    <button mat-raised-button type="button" color="primary"
                                        (click)="buscarClientePorDni()">Buscar</button>
                                </div>
                            </div>
                            <div class="col-md-20" style="margin: 0 5%;">
                                <div class="inputContent">
                                    <h5>3. Nombres: </h5>
                                    <mat-form-field class="col-md-9">
                                        <mat-label>Ingrese los nombres</mat-label>
                                        <input matInput formControlName="nombres" [(ngModel)]="varNombres"
                                            maxlength="30">
                                        <mat-hint style="color: red"
                                            *ngIf="formRegistraUsuario.controls.nombres.touched">
                                            <span *ngIf="formRegistraUsuario.controls.nombres.hasError('required')">
                                                Los nombres son requeridos
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.nombres.hasError('pattern')">
                                                Ingrese sólo letras
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.nombres.hasError('minLength')">
                                                Ingrese mínimo 3 caracteres
                                            </span>
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="col-md-20" style="margin: 0 5%;">
                                <div class="inputContent">
                                    <h5>4. Apellidos: </h5>
                                    <mat-form-field class="col-md-9">
                                        <mat-label>Ingrese los apellidos</mat-label>
                                        <input matInput formControlName="apellidos" [(ngModel)]="varApellidos"
                                            maxlength="40">
                                        <mat-hint style="color: red"
                                            *ngIf="formRegistraUsuario.controls.apellidos.touched">
                                            <span *ngIf="formRegistraUsuario.controls.apellidos.hasError('required')">
                                                Los apellidos son requeridos
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.apellidos.hasError('pattern')">
                                                Ingrese sólo letras
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.apellidos.hasError('minLength')">
                                                Ingrese mínimo 3 caracteres
                                            </span>
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="col-md-20" style="margin: 0 5%;">
                                <div class="inputContent">
                                    <h5>5. Teléfono: </h5>
                                    <mat-form-field class="col-md-9">
                                        <mat-label>Ingrese el número de teléfono</mat-label>
                                        <input matInput formControlName="telefono" maxlength="9">
                                        <mat-hint style="color: red"
                                            *ngIf="formRegistraUsuario.controls.telefono.touched">
                                            <span *ngIf="formRegistraUsuario.controls.telefono.hasError('required')">
                                                El teléfono es requerido
                                            </span>
                                            <span *ngIf="formRegistraUsuario.controls.telefono.hasError('pattern')">
                                                Ingrese un teléfono válido (fijo o personal)
                                            </span>
                                        </mat-hint>
                                    </mat-form-field>
                                </div>
                            </div>
                
                            <div class="row btnEnd">
                            <button mat-raised-button (click)="crearCliente()"  (click)="guardarNombresApe(); stepper.next()"
                                [disabled]="habilitarBtnSiguienteRegistroUsuario()">
                                Siguiente <mat-icon>arrow_forward</mat-icon>
                            </button>
                        </div>
                            </form>
                        </mat-step>
        
                        <!-- Apartado 3: Datos del vehículo -->
                        <mat-step [stepControl]="formRegistraVehiculo" label="Datos del Vehículo"   >
                            <form [formGroup]="formRegistraVehiculo">
                                <div class="row">
                                    <mat-toolbar
                                        style="background:#4B9DA6; border-radius: 20px 20px 20px 20px; padding-left: 5%;">
                                        <h1>Datos del Vehículo</h1>
                                    </mat-toolbar>
                                </div>
        
                        
                                    <div  class="col-md-10" style="margin: 0 5%;">
                                        <div class="inputContent">
                                            <h5>7. Placa:</h5>
                                            <mat-form-field class="col-md-6">
                                                <mat-label>Ingrese la placa del vehículo</mat-label>
                                                <input matInput formControlName="placa" maxlength="8">
                                            </mat-form-field>
                                        
                                        </div>
                                    </div>

                                    <div  class="col-md-10" style="margin: 0 5%;">
                                        <div class="inputContent">
                                            <h5>8. Cantidad de personas:</h5>
                                            <mat-form-field class="col-md-6">
                                                <mat-label>Ingrese la cantidad de personas</mat-label>
                                                <input matInput type="number" formControlName="cantPersonas">
                                            </mat-form-field>
                                        </div>   
                                    </div>

        
                                <div class="row btnEnd">
                                    <button mat-raised-button color="primary" (click)="stepper.previous()">Atrás</button>
                                    <button mat-raised-button  (click)="stepper.next()">Siguiente
                                        <mat-icon>arrow_forward</mat-icon>
                                    </button>
                                </div>
                            </form>
                        </mat-step>
        
                        <!-- Apartado 4: Resumen de Datos -->
                <mat-step [stepControl]="formRegistraVehiculo" label="Registro">
                    <div class="row">
                        <mat-toolbar style="background:#4B9DA6; border-radius: 20px 20px 20px 20px; padding-left: 5%;">
                            <h2>Datos del Registro</h2>
                        </mat-toolbar>
                    </div>

                    <br>

                    <div class="row">
                        <!-- Columna de Propietario -->
                        <div class="col-md-6 section-propietario">
                            <div class="section-header">
                                <h6>Datos del propietario:</h6>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Tipo de usuario:</strong> {{ formRegistraUsuario.value.tipoUsuario }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>DNI/Documento:</strong> {{ formRegistraUsuario.value.dni }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Nombres:</strong> {{ varNombres }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Apellidos:</strong> {{ varApellidos }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Teléfono:</strong> {{ formRegistraUsuario.value.telefono }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Columna de Vehículo -->
                        <div class="col-md-6 section-vehiculo">
                            <div class="section-header">
                                <h6>Datos del vehículo</h6>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Tipo de vehículo:</strong> {{ formRegistraVehiculo.value.tipoVehiculo }}
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Placa:</strong> {{ formRegistraVehiculo.value.placa }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Espacio asignado:</strong> {{ espacioSeleccionado}}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p><strong>Ingreso:</strong> {{ formattedDate }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row btnEnd">
                        <button mat-raised-button color="primary" (click)="stepper.previous()">Atrás</button>
                        <button mat-raised-button (click)="guardarDatos()">Guardar</button>
                    </div>
                </mat-step>
                    </mat-horizontal-stepper>
                </div>
            </div>
        </div>
        

   
    </div>
</div>